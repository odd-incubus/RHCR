# RHCR Simulation Launcher and Tools

This project provides a set of Python scripts to help configure, run, and manage the [RHCR (Robust High-level Collision Resolution)](https://github.com/Jiaoyang-Li/RHCR) lifelong multi-agent pathfinding simulation engine.

## Overview

The primary goal of these scripts is to simplify the interaction with the powerful but complex `lifelong` C++ executable from the RHCR project. Instead of manually constructing long and error-prone command-line strings, you can use these tools to launch simulations and generate necessary configuration files.

-   `lifelong_launcher.py`: A command-line wrapper that acts as a launcher for the `lifelong` simulation. It provides a structured way to pass all necessary parameters and even forwards extra arguments directly to the C++ executable.
-   `generate_goals.py`: A utility script to parse MAPF map files (`.map`) and extract traversable locations. This is useful for generating custom task files for your agents.

## Requirements

-   A compiled binary of the RHCR `lifelong` executable.
-   Python 3.6 or newer.

---

## Scripts

### 1. Lifelong Launcher (`lifelong_launcher.py`)

This script is the main entry point for running a simulation. It dynamically constructs the command to run the `lifelong` executable based on the arguments you provide.

#### **Syntax**

```bash
python lifelong_launcher.py <path_to_lifelong> --map_file <map> --output_folder <out> --num_agents <k> --scenario <name> --solver <name> [options]
```

#### **Required Arguments**

-   `lifelong_path`: The file path to your compiled `lifelong` executable.
-   `-m, --map_file`: Path to the environment map file (e.g., `maps/random-64-64-20.map`).
-   `-o, --output_folder`: Directory where the simulation results will be saved.
-   `-k, --num_agents`: The number of agents to include in the simulation.
-   `--scenario`: The name of the simulation scenario (e.g., `SORTING`, `KIVA`, `ONLINE`).
-   `--solver`: The pathfinding solver to use (e.g., `PBS`, `LRA`, `ECBS`).

#### **Optional Arguments**

-   `--simulation_time`: Total number of timesteps for the simulation (default: `5000`).
-   `--simulation_window`: The replanning period, `h` (default: `5`).
-   `--planning_window`: The planning horizon, `w` (default: `100`).
-   `--task`: Path to a pre-generated task file.
-   `-d, --seed`: A random seed for the simulation (default: `0`).
-   `--suboptimal_bound`: The suboptimality factor for the solver (default: `1.1`).

Any additional, unrecognized arguments (e.g., `--rotation` or `--robust 1`) will be automatically passed through to the `lifelong` executable.

#### **Example Usage**

```bash
python lifelong_launcher.py ./lifelong \
    -m maps/random-64-64-20.map \
    -o exp/sorting_test_1 \
    -k 25 \
    --scenario SORTING \
    --solver PBS \
    --simulation_time 1000 \
    --seed 42 \
    --rotation
```

---

### 2. Goal Generator (`generate_goals.py`)

This script reads a `.map` file, finds all traversable cells (marked with `.`), and generates a list of random goal locations. This is useful for creating custom scenarios.

#### **Syntax**

```bash
python generate_goals.py <map_file_path> --num_goals <N> [--output <output_file.json>]
```

#### **Arguments**

-   `map_file_path`: The path to the map file you want to process.
-   `--num_goals`: The number of unique, random goal locations to generate.
-   `--output`: (Optional) A file path to save the generated goals in JSON format. If omitted, the goals are printed to the console.

#### **Example Usage**

Generate 50 random goals from a map and save them to a file named `my_goals.json`:

```bash
python generate_goals.py maps/random-64-64-20.map --num_goals 50 --output my_goals.json
```

---

## Example Workflow

1.  **Compile `lifelong`**: First, compile the `lifelong` executable from the original RHCR source code. Place the binary in a known location (e.g., the root of this project).

2.  **Generate Goals (Optional)**: If you need a custom set of tasks, generate a list of possible goals from your map.
    ```bash
    python generate_goals.py maps/my_warehouse.map --num_goals 100 --output warehouse_goals.json
    ```
    You can then use this JSON file to create a task file that the `lifelong` executable can understand.

3.  **Run a Simulation**: Use the `lifelong_launcher.py` to start a simulation with your desired parameters.
    ```bash
    python lifelong_launcher.py ./lifelong \
        -m maps/my_warehouse.map \
        -o exp/warehouse_sim_1 \
        -k 40 \
        --scenario SORTING \
        --solver PBS \
        --task tasks/my_tasks.txt
    ```

4.  **Analyze Results**: Once the simulation is complete, check the specified output folder (`exp/warehouse_sim_1`) for the result files generated by the `lifelong` executable.
